<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Measurement Sheet</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    .form-section {
      background: #f9f9f9;
      border-radius: 10px;
      padding: 20px;
    }
    .table-section {
      max-height: 500px;
      overflow-y: auto;
    }
  </style>
</head>
<body>
  <div class="container mt-4">
    <div class="row">
      <!-- Left Side Form -->
      <div class="col-md-4">
        <div class="form-section">
          <h4 class="mb-3">Add Measurement</h4>
          <form id="measurementForm">
            <div class="mb-2">
              <label>Duct No</label>
              <input type="text" name="duct_no" class="form-control" required>
            </div>
            <div class="mb-2">
              <label>Type</label>
              <select name="duct_type" class="form-select" required>
                <option value="">Select</option>
                <option value="ST">ST</option>
                <option value="RED">RED</option>
                <option value="OFFSET">OFFSET</option>
                <option value="SHOE">SHOE</option>
                <option value="DUM">DUM</option>
                <option value="VANES">VANES</option>
                <option value="ELB">ELB</option>
              </select>
            </div>
            <div class="mb-2">
              <label>Width1</label>
              <input type="number" name="width1" class="form-control" required>
            </div>
            <div class="mb-2">
              <label>Height1</label>
              <input type="number" name="height1" class="form-control" required>
            </div>
            <div class="mb-2">
              <label>Width2</label>
              <input type="number" name="width2" class="form-control" value="0">
            </div>
            <div class="mb-2">
              <label>Height2</label>
              <input type="number" name="height2" class="form-control" value="0">
            </div>
            <div class="mb-2">
              <label>Length</label>
              <input type="number" name="length" class="form-control" required>
            </div>
            <div class="mb-2">
              <label>Degree</label>
              <input type="number" name="degree" class="form-control" value="0">
            </div>
            <div class="mb-2">
              <label>Quantity</label>
              <input type="number" name="qty" class="form-control" required>
            </div>
            <div class="mb-3">
              <label>Factor</label>
              <input type="number" name="factor" class="form-control" step="0.01" value="1">
            </div>
            <button type="submit" class="btn btn-primary w-100">Add Entry</button>
          </form>
        </div>
      </div>

      <!-- Right Side Table -->
      <div class="col-md-8">
        <div class="form-section">
          <h4 class="mb-3">Measurement Table</h4>
          <div class="table-section">
            <table class="table table-bordered table-striped" id="measurementTable">
              <thead class="table-dark text-center">
                <tr>
                  <th>Duct No</th>
                  <th>Type</th>
                  <th>Width1</th>
                  <th>Height1</th>
                  <th>Width2</th>
                  <th>Height2</th>
                  <th>Length</th>
                  <th>Degree</th>
                  <th>Qty</th>
                  <th>Factor</th>
                  <th>Gauge</th>
                  <th>Area (mÂ²)</th>
                  <th>24g</th>
                  <th>22g</th>
                  <th>20g</th>
                  <th>18g</th>
                  <th>Nuts & Bolts</th>
                  <th>Cleat</th>
                  <th>Gasket (m)</th>
                  <th>Corner</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="tableBody">
                <!-- Dynamic rows will be inserted here -->
              </tbody>
              <tfoot class="table-warning fw-bold text-center">
                <tr>
                  <td colspan="11">Totals</td>
                  <td id="totalArea">0</td>
                  <td id="total24g">0</td>
                  <td id="total22g">0</td>
                  <td id="total20g">0</td>
                  <td id="total18g">0</td>
                  <td id="totalNutsBolts">0</td>
                  <td id="totalCleat">0</td>
                  <td id="totalGasket">0</td>
                  <td id="totalCorner">0</td>
                </tr>
              </tfoot>
            </table>
          </div>

          <div class="d-flex gap-2 justify-content-end mt-3">
            <button class="btn btn-success" onclick="exportTable()">Export</button>
            <button class="btn btn-secondary" onclick="window.print()">Print</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const form = document.getElementById("measurementForm");
    const tableBody = document.getElementById("tableBody");

    let ductCount = 1;

    form.addEventListener("submit", function (e) {
      e.preventDefault();

      const formData = new FormData(form);
      const entry = Object.fromEntries(formData.entries());

      entry.width1 = parseFloat(entry.width1);
      entry.height1 = parseFloat(entry.height1);
      entry.width2 = parseFloat(entry.width2);
      entry.height2 = parseFloat(entry.height2);
      entry.length = parseFloat(entry.length);
      entry.qty = parseInt(entry.qty);
      entry.factor = parseFloat(entry.factor);
      entry.degree = parseInt(entry.degree);

      let avgWidth = (entry.width1 + entry.width2) / 2;
      let avgHeight = (entry.height1 + entry.height2) / 2;
      let area = ((avgWidth / 1000) * (avgHeight / 1000) * (entry.length / 1000)) * entry.qty * entry.factor;
      let gauge = "24g";
      if (avgWidth > 750 || avgHeight > 750) gauge = "22g";
      if (avgWidth > 1200 || avgHeight > 1200) gauge = "20g";
      if (avgWidth > 1800 || avgHeight > 1800) gauge = "18g";

      let nuts = (entry.length * 4 / 1000) * entry.qty;
      let cleat = (entry.length * 2 / 1000) * entry.qty;
      let gasket = ((entry.width1 + entry.width2 + entry.height1 + entry.height2) * 2 / 1000) * entry.qty;
      let corner = 4 * entry.qty;

      const row = document.createElement("tr");
      row.classList.add("text-center");

      row.innerHTML = `
        <td>${ductCount}</td>
        <td>${entry.type}</td>
        <td>${entry.width1}</td>
        <td>${entry.height1}</td>
        <td>${entry.width2}</td>
        <td>${entry.height2}</td>
        <td>${entry.length}</td>
        <td>${entry.degree}</td>
        <td>${entry.qty}</td>
        <td>${entry.factor}</td>
        <td>${gauge}</td>
        <td class="area">${area.toFixed(2)}</td>
        <td class="g24">${gauge === "24g" ? area.toFixed(2) : 0}</td>
        <td class="g22">${gauge === "22g" ? area.toFixed(2) : 0}</td>
        <td class="g20">${gauge === "20g" ? area.toFixed(2) : 0}</td>
        <td class="g18">${gauge === "18g" ? area.toFixed(2) : 0}</td>
        <td class="nuts">${nuts.toFixed(2)}</td>
        <td class="cleat">${cleat.toFixed(2)}</td>
        <td class="gasket">${gasket.toFixed(2)}</td>
        <td class="corner">${corner}</td>
        <td>
          <button class="btn btn-sm btn-warning" onclick="editRow(this)">Edit</button>
          <button class="btn btn-sm btn-danger" onclick="deleteRow(this)">Delete</button>
        </td>
      `;

      tableBody.appendChild(row);
      ductCount++;
      form.reset();
      updateTotals();
    });

    function updateTotals() {
      const totalArea = sumColumn("area");
      const total24g = sumColumn("g24");
      const total22g = sumColumn("g22");
      const total20g = sumColumn("g20");
      const total18g = sumColumn("g18");
      const totalNutsBolts = sumColumn("nuts");
      const totalCleat = sumColumn("cleat");
      const totalGasket = sumColumn("gasket");
      const totalCorner = sumColumn("corner", true);

      document.getElementById("totalArea").textContent = totalArea.toFixed(2);
      document.getElementById("total24g").textContent = total24g.toFixed(2);
      document.getElementById("total22g").textContent = total22g.toFixed(2);
      document.getElementById("total20g").textContent = total20g.toFixed(2);
      document.getElementById("total18g").textContent = total18g.toFixed(2);
      document.getElementById("totalNutsBolts").textContent = totalNutsBolts.toFixed(2);
      document.getElementById("totalCleat").textContent = totalCleat.toFixed(2);
      document.getElementById("totalGasket").textContent = totalGasket.toFixed(2);
      document.getElementById("totalCorner").textContent = totalCorner;
    }

    function sumColumn(className, isInt = false) {
      const cells = document.querySelectorAll(`.${className}`);
      let sum = 0;
      cells.forEach(cell => sum += isInt ? parseInt(cell.textContent) : parseFloat(cell.textContent));
      return sum;
    }

    function deleteRow(btn) {
      btn.closest("tr").remove();
      updateTotals();
    }

    function editRow(btn) {
      alert("Edit functionality can be implemented here.");
    }

    function exportTable() {
      let table = document.getElementById("measurementTable").outerHTML;
      let blob = new Blob(["\ufeff", table], { type: "application/vnd.ms-excel" });
      let url = URL.createObjectURL(blob);
      let a = document.createElement("a");
      a.href = url;
      a.download = "measurement_sheet.xls";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }
  </script>
</body>
</html>

            
