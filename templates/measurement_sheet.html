<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Measurement Sheet</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <style>
    body {
      background-color: #f8f9fa;
    }
    .form-section {
      background: #fff;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .table-section {
      max-height: 600px;
      overflow-y: auto;
      background: #fff;
      border-radius: 10px;
      padding: 15px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    th, td {
      vertical-align: middle !important;
      font-size: 14px;
    }
    .total-row {
      font-weight: bold;
      background-color: #e6f2ff;
      position: sticky;
      bottom: 0;
      z-index: 1;
    }
    .btn-group-sm > .btn {
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div class="container-fluid mt-3">
    <div class="row">
      <div class="col-md-4">
        <div class="form-section">
          <h5 class="mb-3">Duct Entry Form</h5>
          <form id="ductForm">
            <div class="mb-2">
              <label class="form-label">Duct No</label>
              <input type="text" class="form-control" id="ductNo" required />
            </div>
            <div class="mb-2">
              <label class="form-label">Duct Type</label>
              <select class="form-select" id="ductType" required>
                <option value="">Select Type</option>
                <option value="ST">ST</option>
                <option value="RED">RED</option>
                <option value="DUM">DUM</option>
                <option value="OFFSET">OFFSET</option>
                <option value="SHOE">SHOE</option>
                <option value="VANES">VANES</option>
                <option value="ELB">ELB</option>
              </select>
            </div>
            <div class="row">
              <div class="col-md-6 mb-2">
                <label class="form-label">W1</label>
                <input type="number" class="form-control" id="w1" required />
              </div>
              <div class="col-md-6 mb-2">
                <label class="form-label">H1</label>
                <input type="number" class="form-control" id="h1" required />
              </div>
            </div>
            <div class="row">
              <div class="col-md-6 mb-2">
                <label class="form-label">W2</label>
                <input type="number" class="form-control" id="w2" required />
              </div>
              <div class="col-md-6 mb-2">
                <label class="form-label">H2</label>
                <input type="number" class="form-control" id="h2" required />
              </div>
            </div>

            <div class="row">
              <div class="col-md-6 mb-2">
                <label class="form-label">Length</label>
                <input type="number" class="form-control" id="length" required />
              </div>
              <div class="col-md-6 mb-2">
                <label class="form-label">Quantity</label>
                <input type="number" class="form-control" id="quantity" required />
              </div>
            </div>
            <div class="row">
              <div class="col-md-6 mb-2">
                <label class="form-label">Degree</label>
                <input type="number" class="form-control" id="degree" />
              </div>
              <div class="col-md-6 mb-2">
                <label class="form-label">Factor</label>
                <input type="number" class="form-control" id="factor" />
              </div>
            </div>
            <div class="d-grid">
              <button type="button" class="btn btn-primary" onclick="addEntry()">Add Entry</button>
            </div>
          </form>
        </div>
      </div>
      <div class="col-md-8">
        <div class="table-section">
          <table class="table table-bordered table-sm text-center align-middle" id="entryTable">
            <thead class="table-light sticky-top">
              <tr>
                <th>Duct No</th>
                <th>Type</th>
                <th>W1</th>
                <th>H1</th>
                <th>W2</th>
                <th>H2</th>
                <th>Len</th>
                <th>Qty</th>
                <th>Deg</th>
                <th>Fact</th>
                <th>Gauge</th>
                <th>Area</th>
                <th>24g</th>
                <th>22g</th>
                <th>20g</th>
                <th>18g</th>
                <th>Bolts</th>
                <th>Cleat</th>
                <th>Gasket</th>
                <th>Corner</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="entryBody">
            </tbody>
            <tfoot>
              <tr class="total-row">
                <td colspan="11">TOTAL</td>
                <td id="totalArea">0</td>
                <td id="total24g">0</td>
                <td id="total22g">0</td>
                <td id="total20g">0</td>
                <td id="total18g">0</td>
                <td id="totalBolts">0</td>
                <td id="totalCleat">0</td>
                <td id="totalGasket">0</td>
                <td id="totalCorner">0</td>
                <td></td>
              </tr>
            </tfoot>
          </table>
        </div>
        <div class="d-flex justify-content-end gap-2 mt-2">
          <button class="btn btn-outline-success btn-sm" onclick="exportToExcel()">Export Excel</button>
          <button class="btn btn-outline-danger btn-sm" onclick="exportToPDF()">Export PDF</button>
          <button class="btn btn-outline-primary btn-sm" onclick="window.print()">Print</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    function addEntry() {
      const ductNo = document.getElementById('ductNo').value;
      const type = document.getElementById('type').value;
      const w1 = parseFloat(document.getElementById('w1').value);
      const h1 = parseFloat(document.getElementById('h1').value);
      const w2 = parseFloat(document.getElementById('w2').value);
      const h2 = parseFloat(document.getElementById('h2').value);
      const length = parseFloat(document.getElementById('length').value);
      const qty = parseInt(document.getElementById('quantity').value);
      const degree = parseFloat(document.getElementById('degree').value) || 0;
      const factor = parseFloat(document.getElementById('factor').value) || 1;

      if (!ductNo || !type || isNaN(w1) || isNaN(h1) || isNaN(length) || isNaN(qty)) {
        alert("Please fill in all required fields.");
        return;
      }

      let gauge = '';
      if (w1 <= 751 && h1 <= 751) {
        gauge = '24g';
      } else if (w1 <= 1201 && h1 <= 1201) {
        gauge = '22g';
      } else if (w1 <= 1800 && h1 <= 1800) {
        gauge = '20g';
      } else {
        gauge = '18g';
      }

      let area = 0;
      switch (type) {
        case 'ST':
          area = ((w1 + h1) * 2 * length) / 1000000;
          break;
        case 'RED':
          area = ((w1 + w2 + h1 + h2) * length) / 2000000;
          break;
        case 'DUM':
          area = (w1 * h1) / 1000000;
          break;
        case 'OFFSET':
        case 'SHOE':
        case 'VANES':
          area = ((w1 + h1) * 2 * length * factor) / 1000000;
          break;
        case 'ELB':
          area = ((w1 + h1) * 3.14 * degree * length) / (360 * 1000000);
          break;
        default:
          area = 0;
      }

      const area24 = gauge === '24g' ? area * qty : 0;
      const area22 = gauge === '22g' ? area * qty : 0;
      const area20 = gauge === '20g' ? area * qty : 0;
      const area18 = gauge === '18g' ? area * qty : 0;
      const bolts = qty * 4;
      const cleatFactor = { '24g': 0.25, '22g': 0.3, '20g': 0.4, '18g': 0.5 };
      const cleat = (cleatFactor[gauge] || 0) * qty;
      const gasket = ((w1 + h1 + w2 + h2) / 1000) * qty;
      const corner = type === 'DUM' ? 0 : qty * 8;

      const row = `<tr>
        <td>${ductNo}</td>
        <td>${type}</td>
        <td>${w1}</td>
        <td>${h1}</td>
        <td>${w2}</td>
        <td>${h2}</td>
        <td>${length}</td>
        <td>${qty}</td>
        <td>${degree}</td>
        <td>${factor}</td>
        <td>${gauge}</td>
        <td>${(area * qty).toFixed(2)}</td>
        <td>${area24.toFixed(2)}</td>
        <td>${area22.toFixed(2)}</td>
        <td>${area20.toFixed(2)}</td>
        <td>${area18.toFixed(2)}</td>
        <td>${bolts}</td>
        <td>${cleat.toFixed(2)}</td>
        <td>${gasket.toFixed(2)}</td>
        <td>${corner}</td>
        <td><button class="btn btn-sm btn-danger" onclick="this.closest('tr').remove(); updateTotals();">Delete</button></td>
      </tr>`;

      document.getElementById('entryBody').insertAdjacentHTML('beforeend', row);
      updateTotals();
      document.getElementById('entryForm').reset();
    }

    function updateTotals() {
      let totalArea = 0,
        total24 = 0,
        total22 = 0,
        total20 = 0,
        total18 = 0,
        totalBolts = 0,
        totalCleat = 0,
        totalGasket = 0,
        totalCorner = 0;

      const rows = document.querySelectorAll('#entryBody tr');
      rows.forEach(row => {
        totalArea += parseFloat(row.children[11].textContent) || 0;
        total24 += parseFloat(row.children[12].textContent) || 0;
        total22 += parseFloat(row.children[13].textContent) || 0;
        total20 += parseFloat(row.children[14].textContent) || 0;
        total18 += parseFloat(row.children[15].textContent) || 0;
        totalBolts += parseInt(row.children[16].textContent) || 0;
        totalCleat += parseFloat(row.children[17].textContent) || 0;
        totalGasket += parseFloat(row.children[18].textContent) || 0;
        totalCorner += parseInt(row.children[19].textContent) || 0;
      });

      const totalRow = document.getElementById('totalsRow');
      totalRow.innerHTML = `
        <td colspan="11"><strong>Totals</strong></td>
        <td><strong>${totalArea.toFixed(2)}</strong></td>
        <td><strong>${total24.toFixed(2)}</strong></td>
        <td><strong>${total22.toFixed(2)}</strong></td>
        <td><strong>${total20.toFixed(2)}</strong></td>
        <td><strong>${total18.toFixed(2)}</strong></td>
        <td><strong>${totalBolts}</strong></td>
        <td><strong>${totalCleat.toFixed(2)}</strong></td>
        <td><strong>${totalGasket.toFixed(2)}</strong></td>
        <td><strong>${totalCorner}</strong></td>
        <td></td>`;
    }

    function exportToExcel() {
      const table = document.getElementById('entryTable');
      const wb = XLSX.utils.table_to_book(table, { sheet: "Sheet1" });
      XLSX.writeFile(wb, 'MeasurementSheet.xlsx');
    }

    function exportToPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF('l', 'pt', 'a2');
      doc.autoTable({ html: '#entryTable' });
      doc.save('MeasurementSheet.pdf');
    }

    function printTable() {
      const content = document.getElementById('entryTable').outerHTML;
      const win = window.open('', '', 'width=1000,height=700');
      win.document.write('<html><head><title>Print</title>');
      win.document.write('<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">');
      win.document.write('</head><body>');
      win.document.write(content);
      win.document.write('</body></html>');
      win.document.close();
      win.print();
    }

    function submitData() {
      alert("Data submitted (mockup)");
    }

    function editEntry(row) {
      alert("Edit functionality is not implemented yet.");
    }
  </script>
</body>
</html>


            
