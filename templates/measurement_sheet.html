<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Measurement Sheet</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    .form-section {
      background: #f9f9f9;
      border-radius: 10px;
      padding: 20px;
    }
    .table-section {
      height: 600px;
      overflow-y: scroll;
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 10px;
    }
    .totals-row {
      position: sticky;
      bottom: 0;
      background: #f1f1f1;
    }
    table th, table td {
      white-space: nowrap;
      vertical-align: middle;
    }
  </style>
</head>
<body>
<div class="container-fluid p-3">
  <div class="row">
    <div class="col-md-4">
      <div class="form-section">
        <h4 class="mb-3">Duct Entry Form</h4>
        <form id="entryForm">
          <div class="mb-2"><label>Duct No</label><input type="text" class="form-control" id="ductNo" required /></div>
          <div class="mb-2"><label>Duct Type</label><input type="text" class="form-control" id="ductType" required /></div>
          <div class="mb-2"><label>W1</label><input type="number" class="form-control" id="w1" required /></div>
          <div class="mb-2"><label>H1</label><input type="number" class="form-control" id="h1" required /></div>
          <div class="mb-2"><label>W2</label><input type="number" class="form-control" id="w2" required /></div>
          <div class="mb-2"><label>H2</label><input type="number" class="form-control" id="h2" required /></div>
          <div class="mb-2"><label>Length</label><input type="number" class="form-control" id="length" required /></div>
          <div class="mb-2"><label>Quantity</label><input type="number" class="form-control" id="quantity" required /></div>
          <div class="mb-2"><label>Degree</label><input type="number" class="form-control" id="degree" /></div>
          <div class="mb-2"><label>Factor</label><input type="number" class="form-control" id="factor" /></div>
          <button type="button" class="btn btn-primary w-100" onclick="addEntry()">Add Entry</button>
        </form>
      </div>
    </div>
    <div class="col-md-8">
      <div class="table-section">
        <table class="table table-bordered table-sm" id="entryTable">
          <thead class="table-dark sticky-top">
            <tr>
              <th>Duct No</th><th>Type</th><th>W1</th><th>H1</th><th>W2</th><th>H2</th>
              <th>Length</th><th>Qty</th><th>Deg</th><th>Factor</th><th>Gauge</th><th>Area</th>
              <th>24g</th><th>22g</th><th>20g</th><th>18g</th>
              <th>Bolts</th><th>Cleat</th><th>Gasket</th><th>Corner</th><th>Actions</th>
            </tr>
          </thead>
          <tbody id="entryBody"></tbody>

          <tfoot class="totals-row">
            <tr>
              <th colspan="11" class="text-end">Totals</th>
              <th id="totalArea">0</th>
              <th id="total24g">0</th>
              <th id="total22g">0</th>
              <th id="total20g">0</th>
              <th id="total18g">0</th>
              <th id="totalBolts">0</th>
              <th id="totalCleat">0</th>
              <th id="totalGasket">0</th>
              <th id="totalCorner">0</th>
              <th></th>
            </tr>
          </tfoot>
        </table>
      </div>
      <div class="mt-3 d-flex justify-content-between">
        <button class="btn btn-success" onclick="exportExcel()">Export Excel</button>
        <button class="btn btn-danger" onclick="exportPDF()">Export PDF</button>
        <button class="btn btn-info" onclick="window.print()">Print</button>
        <button class="btn btn-primary" onclick="submitData()">Submit</button>
      </div>
    </div>
  </div>
</div>
<script>
  function getGauge(w, h) {
    if (w <= 751 && h <= 751) return '24g';
    else if (w <= 1201 && h <= 1201) return '22g';
    else if (w <= 1800 && h <= 1800) return '20g';
    else return '18g';
  }
  
function addEntry() {
    const form = document.getElementById('entryForm');
    if (!form.checkValidity()) {
      form.reportValidity();
      return;
    }
    const val = id => document.getElementById(id).value.trim();
    const w1 = +val('w1'), h1 = +val('h1'), w2 = +val('w2'), h2 = +val('h2');
    const len = +val('length'), qty = +val('quantity');
    const deg = +val('degree') || 0, factor = +val('factor') || 0;
    const gauge = getGauge(w1, h1);
    const area = ((w1 + h1 + w2 + h2) * len * qty) / 1000000;
    const areaGauge = { '24g': 0, '22g': 0, '20g': 0, '18g': 0 };
    areaGauge[gauge] = area;
    const bolts = qty * 4;
    const cleatFactor = { '24g': 2, '22g': 3, '20g': 4, '18g': 5 };
    const cleat = qty * cleatFactor[gauge];
    const gasket = ((w1 + h1 + w2 + h2) / 1000) * qty;
    const type = val('ductType');
    const corner = (type.toUpperCase() === 'DUM') ? 0 : qty * 8;

    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${val('ductNo')}</td><td>${type}</td><td>${w1}</td><td>${h1}</td><td>${w2}</td><td>${h2}</td>
      <td>${len}</td><td>${qty}</td><td>${deg}</td><td>${factor}</td><td>${gauge}</td><td>${area.toFixed(2)}</td>
      <td>${areaGauge['24g'].toFixed(2)}</td><td>${areaGauge['22g'].toFixed(2)}</td>
      <td>${areaGauge['20g'].toFixed(2)}</td><td>${areaGauge['18g'].toFixed(2)}</td>
      <td>${bolts}</td><td>${cleat}</td><td>${gasket.toFixed(2)}</td><td>${corner}</td>
      <td><button class="btn btn-sm btn-danger" onclick="this.closest('tr').remove(); calcTotals();">Delete</button></td>
    `;
    document.getElementById('entryBody').appendChild(row);
    form.reset();
    calcTotals();
}

  function calcTotals() {
    const rows = document.querySelectorAll('#entryBody tr');
    let tArea = 0, t24g = 0, t22g = 0, t20g = 0, t18g = 0;
    let bolts = 0, cleat = 0, gasket = 0, corner = 0;
    rows.forEach(row => {
      tArea += +row.cells[11].innerText;
      t24g += +row.cells[12].innerText;
      t22g += +row.cells[13].innerText;
      t20g += +row.cells[14].innerText;
      t18g += +row.cells[15].innerText;
      bolts += +row.cells[16].innerText;
      cleat += +row.cells[17].innerText;
      gasket += +row.cells[18].innerText;
      corner += +row.cells[19].innerText;
    });
    document.getElementById('totalArea').innerText = tArea.toFixed(2);
    document.getElementById('total24g').innerText = t24g.toFixed(2);
    document.getElementById('total22g').innerText = t22g.toFixed(2);
    document.getElementById('total20g').innerText = t20g.toFixed(2);
    document.getElementById('total18g').innerText = t18g.toFixed(2);
    document.getElementById('totalBolts').innerText = bolts;
    document.getElementById('totalCleat').innerText = cleat;
    document.getElementById('totalGasket').innerText = gasket.toFixed(2);
    document.getElementById('totalCorner').innerText = corner;
  }

  function exportExcel() {
    let data = [];
    document.querySelectorAll("#entryBody tr").forEach(row => {
      data.push([...row.children].map(cell => cell.innerText));
    });
    let csv = "DuctNo,Type,W1,H1,W2,H2,Length,Qty,Deg,Factor,Gauge,Area,24g,22g,20g,18g,Bolts,Cleat,Gasket,Corner\n";
    data.forEach(row => { csv += row.slice(0, 20).join(",") + "\n"; });
    const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "measurement_sheet.csv";
    link.click();
  }

  function exportPDF() {
    window.print();
  }

  function submitData() {
    alert("Data submitted successfully!");
  }
</script>
</body>
</html>
          

          
