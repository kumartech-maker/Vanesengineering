<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Measurement Sheet</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <style>
        body {
            background-color: #f5f5f5;
        }

        .form-section {
            background-color: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        .table-section {
            background-color: #fff;
            padding: 20px;
            margin-top: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        .form-label {
            font-weight: 600;
        }

        .btn-action {
            margin-right: 10px;
        }

        .modal-content {
            border-radius: 12px;
        }
    </style>
</head>
<body>

    <div class="container mt-5">

        <div class="form-section">
            <h4>Measurement Sheet Entry</h4>
            <form id="entryForm">
                <div class="row mb-3">
                    <div class="col-md-3">
                        <label class="form-label">Duct Type</label>
                        <select class="form-select" name="duct_type" required>
                            <option value="ST">ST</option>
                            <option value="RED">RED</option>
                            <option value="DUM">DUM</option>
                            <option value="OFFSET">OFFSET</option>
                            <option value="SHOE">SHOE</option>
                            <option value="VANES">VANES</option>
                            <option value="ELB">ELB</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Width 1</label>
                        <input type="number" class="form-control" name="width1" required>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Height 1</label>
                        <input type="number" class="form-control" name="height1" required>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Width 2</label>
                        <input type="number" class="form-control" name="width2" required>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-3">
                        <label class="form-label">Height 2</label>
                        <input type="number" class="form-control" name="height2" required>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Length</label>
                        <input type="number" class="form-control" name="length" required>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Degree</label>
                        <input type="number" class="form-control" name="degree" value="0">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Quantity</label>
                        <input type="number" class="form-control" name="quantity" required>
                    </div>
                </div>

                <div class="d-flex justify-content-end">
                    <button type="submit" class="btn btn-success btn-action">Add Entry</button>
                    <button type="button" class="btn btn-secondary btn-action" id="exportExcel">Export to Excel</button>
                    <button type="button" class="btn btn-primary btn-action" id="saveAll">Save All</button>
                </div>
            </form>
        </div>

        <div class="table-section">
            <h5>Measurement Entries</h5>
            <table class="table table-bordered table-striped mt-3" id="entriesTable">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Duct Type</th>
                        <th>W1</th>
                        <th>H1</th>
                        <th>W2</th>
                        <th>H2</th>
                        <th>Length</th>
                        <th>Degree</th>
                        <th>Qty</th>
                        <th>Gauge</th>
                        <th>Area</th>
                        <th>Nuts/Bolts</th>
                        <th>Cleat</th>
                        <th>Gasket</th>
                        <th>Corner</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="entriesBody">
                    <!-- dynamic rows -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        let entries = [];

        function calculate(entry) {
            const { duct_type, width1, height1, width2, height2, length, degree, quantity } = entry;
            let area = 0, gauge = '18g', nuts_bolts = 0, cleat = 0, gasket = 0, corner = 0;

            const factor = 1; // placeholder if needed

            if (duct_type === 'ST') {
                area = 2 * (width1 + height1) / 1000 * (length / 1000) * quantity;
            } else if (duct_type === 'RED') {
                area = (width1 + height1 + width2 + height2) / 1000 * (length / 1000) * quantity * factor;
            } else if (duct_type === 'DUM') {
                area = (width1 * height1) / 1_000_000 * quantity;
            } else if (duct_type === 'OFFSET') {
                area = (width1 + height1 + width2 + height2) / 1000 * ((length + degree) / 1000) * quantity * factor;
            } else if (duct_type === 'SHOE') {
                area = (width1 + height1) * 2 / 1000 * (length / 1000) * quantity * factor;
            } else if (duct_type === 'VANES') {
                area = width1 / 1000 * (2 * 3.14 * (width1 / 1000) / 4) * quantity;
            } else if (duct_type === 'ELB') {
                area = 2 * (width1 + height1) / 1000 * ((height1 / 2 / 1000) + (length / 1000) * (3.14 * (degree / 180))) * quantity * factor;
            }

            // Gauge logic
            if (width1 <= 751 && height1 <= 751) {
                gauge = '24g';
            } else if (width1 <= 1201 && height1 <= 1201) {
                gauge = '22g';
            } else if (width1 <= 1800 && height1 <= 1800) {
                gauge = '20g';
            }

            nuts_bolts = quantity * 4;

            cleat = quantity * (gauge === '24g' ? 4 : gauge === '22g' ? 8 : gauge === '20g' ? 10 : 12);

            gasket = (width1 + height1 + width2 + height2) / 1000 * quantity;

            corner = (duct_type === 'DUM') ? 0 : quantity * 8;

            return { area: area.toFixed(2), gauge, nuts_bolts, cleat, gasket: gasket.toFixed(2), corner };
        }

        function renderTable() {
            const tbody = $('#entriesBody');
            tbody.empty();
            entries.forEach((e, i) => {
                const c = calculate(e);
                tbody.append(`
                    <tr>
                        <td>${i + 1}</td>
                        <td>${e.duct_type}</td>
                        <td>${e.width1}</td>
                        <td>${e.height1}</td>
                        <td>${e.width2}</td>
                        <td>${e.height2}</td>
                        <td>${e.length}</td>
                        <td>${e.degree}</td>
                        <td>${e.quantity}</td>
                        <td>${c.gauge}</td>
                        <td>${c.area}</td>
                        <td>${c.nuts_bolts}</td>
                        <td>${c.cleat}</td>
                        <td>${c.gasket}</td>
                        <td>${c.corner}</td>
                        <td><button class="btn btn-danger btn-sm" onclick="deleteEntry(${i})">Delete</button></td>
                    </tr>
                `);
            });
        }

        $('#entryForm').submit(function (e) {
            e.preventDefault();
            const formData = $(this).serializeArray();
            const entry = {};
            formData.forEach(f => entry[f.name] = parseFloat(f.value) || f.value);
            entries.push(entry);
            renderTable();
            this.reset();
        });

        function deleteEntry(index) {
            entries.splice(index, 1);
            renderTable();
        }

        $('#exportExcel').click(function () {
            alert('Excel export logic can be connected via backend.');
        });

        $('#saveAll').click(function () {
            alert('Save logic can be integrated with Flask backend.');
        });
    </script>

</body>
</html>
